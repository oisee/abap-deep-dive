# Патч для критических исправлений Главы 4
# Дата: 2025-07-21
# Применить с помощью скрипта apply_patches.py

## КРИТИЧЕСКИЕ ИСПРАВЛЕНИЯ

### Исправление 1: Корректировка адреса Kernel Space
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 34-36
- Найти: "Kernel Space (0x8000...)"
- Заменить: "Kernel Space (зависит от платформы, например 0xFFFF800000000000 для Linux x64)"
- Причина: Неверный адрес для 64-битных систем

### Исправление 2: Исправить значение ztta/roll_first
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 171
- Найти: "ztta/roll_first = 1 (default: 1 byte)"
- Заменить: "ztta/roll_first = 1024 (default: 1 KB)"
- Причина: Неверное значение по умолчанию согласно SAP Note 1648418

### Исправление 3: Исправить размер блока Extended Memory
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 191
- Найти: "em/blocksize_KB (обычно 4096 KB)"
- Заменить: "em/blocksize_KB (обычно 1024 KB, может быть увеличен до 4096 KB)"
- Причина: Стандартное значение 1024 KB согласно документации

### Исправление 4: Исправить значение abap/heap_area_nondia
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 338
- Найти: "abap/heap_area_nondia = 4000000000  \" 4 GB heap для фоновых WP"
- Заменить: "abap/heap_area_nondia = 0  \" 0 = неограниченно для фоновых WP (по умолчанию)"
- Причина: Неверное значение по умолчанию

### Исправление 5: Заменить устаревший kernel вызов
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 354-355
- Найти:
```abap
CALL 'C_SAPGPARAM' ID 'NAME' FIELD 'abap/heap_area_dia'
                   ID 'VALUE' FIELD ls_params-heap_area_dia.
```
- Заменить:
```abap
* Современный способ получения параметров
DATA(lv_value) = cl_spfl_profile_parameter=>get_value( 
  name = 'abap/heap_area_dia' ).
ls_params-heap_area_dia = lv_value.
* Альтернатива: FM SAPPARAM_GET_VALUE
```
- Причина: Прямые вызовы kernel функций устарели

### Исправление 6: Исправить параметр PXA буфера
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 471
- Найти: "Program Buffer PXA<br/>abap/buffersize"
- Заменить: "Program Buffer PXA<br/>Размер вычисляется автоматически"
- Причина: Параметр abap/buffersize не существует для PXA

### Исправление 7: Удалить несуществующий kernel вызов
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 611-614
- Найти:
```abap
CALL 'GET_BUFFER_INFO' ID 'BUFFER' FIELD 'PXA'
                       ID 'SIZE' FIELD lv_pxa_size
                       ID 'USED' FIELD lv_pxa_used.
```
- Заменить:
```abap
* Получение информации о буферах через системные таблицы
* или транзакцию ST02
* Прямого API для получения статистики буферов нет
* Используйте класс CL_SHMM_UTILS для работы с shared memory
```
- Причина: Не существует документированного вызова GET_BUFFER_INFO

### Исправление 8: Исправить значение em/initial_size_MB
- Файл: ADD - Глава 4 Иерархия памяти - балансировка между масштабируемостью и выживанием.md
- Строка: 641
- Найти: "em/initial_size_MB<br/>Default: OS dependent"
- Заменить: "em/initial_size_MB<br/>Default: 16384 MB (16 GB) для современных систем"
- Причина: Неверное описание значения по умолчанию