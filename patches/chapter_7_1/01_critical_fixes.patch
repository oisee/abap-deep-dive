# Патч для критических исправлений Главы 7.1 (Приложение)
# Дата: 2025-07-21
# Применить с помощью скрипта apply_patches.py

## КРИТИЧЕСКИЕ ИСПРАВЛЕНИЯ

### Исправление 1: Добавить порт DIAG
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: после описания DIAG
- Добавить:
```
### Порты DIAG
- Стандартный порт: 32NN (где NN - номер инстанса)
- Пример: 3200 для instance 00, 3201 для instance 01
- Настраивается параметром: rdisp/msserv_internal
```
- Причина: Отсутствует критически важная информация о портах

### Исправление 2: Исправить алгоритм сжатия DIAG
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: где упоминается LZH/LZC
- Найти: "сжатие LZH/LZC"
- Заменить: "сжатие LZF (Lempel-Ziv-Fast) в современных версиях, ранее использовался собственный алгоритм SAP"
- Причина: Неверная информация об алгоритме сжатия

### Исправление 3: Уточнить безопасность DIAG
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: где говорится об отсутствии шифрования
- Найти: "шифрование отсутствует по умолчанию"
- Заменить: "С NetWeaver 7.40 поддерживается SNC (Secure Network Communications) и TLS шифрование. По умолчанию отключено для совместимости"
- Причина: Устаревшая информация о безопасности

### Исправление 4: Добавить порты RFC
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: после описания RFC
- Добавить:
```
### Порты RFC
- Gateway port: 33NN (основной)
- Program port: 48NN (для external programs)
- Secured port: 48NN (при использовании SNC)
Где NN - номер инстанса
```
- Причина: Отсутствует информация о портах

### Исправление 5: Добавить варианты RFC
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: после базового описания RFC
- Добавить:
```
### Варианты RFC

1. **sRFC** (Synchronous RFC) - синхронный вызов
2. **tRFC** (Transactional RFC) - гарантированная доставка
3. **qRFC** (Queued RFC) - последовательная обработка
4. **bgRFC** (Background RFC) - с NetWeaver 7.11, замена tRFC/qRFC
5. **aRFC** (Asynchronous RFC) - асинхронный вызов
```
- Причина: Неполное описание вариантов RFC

### Исправление 6: Исправить endpoints ADT
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: где перечислены ADT endpoints
- Заменить на:
```
### ADT Endpoints по версиям

**NetWeaver 7.31+**:
- `/sap/bc/adt/discovery` - точка входа

**NetWeaver 7.40+**:
- `/sap/bc/adt/repository/informationsystem` - поиск объектов
- `/sap/bc/adt/oo/classes` - работа с классами

**NetWeaver 7.50+**:
- `/sap/bc/adt/vit` - ABAP Unit тесты
- `/sap/bc/adt/atc` - ABAP Test Cockpit
```
- Причина: Неверная версионная информация

### Исправление 7: Исправить методы аутентификации ADT
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: где перечислены методы аутентификации
- Найти: список с OAuth 2.0
- Заменить:
```
### Методы аутентификации ADT

**On-premise системы**:
- Basic Authentication (стандарт)
- SAML 2.0 (enterprise SSO)
- X.509 certificates
- Kerberos (Windows domains)

**Cloud/BTP системы**:
- OAuth 2.0
- SAML 2.0
```
- Причина: OAuth 2.0 не используется для on-premise

### Исправление 8: Исправить порты Message Server
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: где указан порт 3900
- Найти: "3900 + Instance"
- Заменить:
```
### Порты Message Server
- Internal: 36NN (для диспетчеров)
- HTTP: 81NN (для мониторинга)
- HTTPS: 443NN или 444NN
Где NN - номер инстанса

Примечание: 39NN используется для Enqueue Server
```
- Причина: Неверный номер порта

### Исправление 9: Исправить имена файлов Gateway
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: где упоминаются reg_info и sec_info
- Найти: "reg_info", "sec_info"
- Заменить:
```
### Файлы безопасности Gateway

Современные имена (с NetWeaver 7.40):
- `reginfo` - регистрация программ
- `secinfo` - безопасность соединений
- `prxyinfo` - настройки прокси

Устаревшие имена:
- `reginfo.dat`, `secinfo.dat` (до 7.40)

Расположение: DIR_DATA или /usr/sap/<SID>/<INSTANCE>/data/
```
- Причина: Неверные имена файлов

### Исправление 10: Добавить APC протокол
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: в конце файла
- Добавить:
```
## APC (ABAP Push Channel) Protocol

### Описание
WebSocket-based протокол для push-коммуникаций в ABAP

### Характеристики
- Базируется на WebSocket (RFC 6455)
- Порт: использует ICM порты (80NN для ws://, 443NN для wss://)
- Доступен с NetWeaver 7.40 SP08

### Архитектура
```mermaid
graph LR
    Browser[Browser/Client] -->|WebSocket| ICM[ICM]
    ICM --> APC[APC Handler]
    APC --> ABAP[ABAP Application]
```

### Применение
- Real-time уведомления
- Collaborative сценарии
- IoT интеграция
```
- Причина: APC упомянут в заголовке, но отсутствует в содержании

### Исправление 11: Добавить информацию о версиях протоколов
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: для каждого протокола
- Добавить версионную информацию:
```
### Версии протоколов

**DIAG**:
- Classic DIAG: до NetWeaver 6.20
- New DIAG: 6.20+
- Enhanced DIAG: 7.00+ (поддержка новых UI элементов)

**RFC**:
- RFC v1: до 4.0
- RFC v2: 4.0+ (улучшенная производительность)
- RFC v3: 6.40+ (поддержка Unicode)
```
- Причина: Отсутствует версионная информация

### Исправление 12: Добавить метрики производительности
- Файл: ADD - Глава 7 Приложение Протоколы SAP - открытость и внутреннее устройство.md
- Строка: для каждого протокола
- Добавить:
```
### Характеристики производительности

**DIAG**:
- Сжатие: 50-90% для типичных экранов
- Латентность: 10-50ms (LAN)
- Пропускная способность: до 10MB/s

**RFC**:
- Overhead: ~200 bytes на вызов
- Латентность: 1-5ms (LAN)
- Пропускная способность: до 100MB/s
```
- Причина: Отсутствуют метрики производительности