# TODO: Глава 4 - Иерархия памяти

## Высокий приоритет

- [ ] [TODO.1] Добавить правильные адреса kernel space для разных платформ
  - **Контекст**: Строка 34-36, архитектура адресного пространства
  - **Что нужно**: Точные адреса для Linux x64, Windows x64, AIX, Solaris
  - **Как получить**: Документация ОС, SAP Platform guides

- [ ] [TODO.2] Исправить все параметры памяти на актуальные значения
  - **Контекст**: Весь документ
  - **Что нужно**: Проверить и исправить значения по умолчанию согласно SAP Note 1648418
  - **Как получить**: SAP Notes, параметры из работающей системы S/4HANA

- [ ] [TODO.3] Заменить все прямые kernel вызовы на современные методы
  - **Контекст**: Строки 354-355, 611-614, 687-689, 706-709
  - **Что нужно**: Использовать CL_SPFL_PROFILE_PARAMETER или FM
  - **Как получить**: SAP Help Portal, современные примеры ABAP

- [ ] [TODO.4] Добавить полную информацию о Extended Memory механизме
  - **Контекст**: Строки 183-237
  - **Что нужно**: 
    - em/address_space_MB
    - em/global_area_MB
    - Механизм allocation
    - Различия Unix/Windows
  - **Как получить**: SAP Help Portal - Memory Management

- [ ] [TODO.5] Добавить детальное описание Roll Area механизма
  - **Контекст**: Строки 239-260
  - **Что нужно**:
    - Roll Buffer (shared memory)
    - Roll File (file system)
    - Параметры rdisp/ROLL_MAXFS, rdisp/ROLL_SHM
    - Процесс roll-in/roll-out
  - **Как получить**: SAP documentation, ST02 analysis

- [ ] [TODO.6] Создать полный пример мониторинга памяти
  - **Контекст**: Строки 595-631
  - **Что нужно**: Рабочий код для получения статистики буферов
  - **Как получить**: Использовать класс CL_SYSTEM_MONITOR или данные из ST02

## Средний приоритет

- [ ] [TODO.7] Добавить платформенные различия для memory mapping
  - **Контекст**: Строки 44-87
  - **Что нужно**: Примеры для Unix (shmat/mmap) и Windows (CreateFileMapping)
  - **Как получить**: SAP platform-specific guides

- [ ] [TODO.8] Расширить информацию о типах буферизации таблиц
  - **Контекст**: Строки 542-563
  - **Что нужно**:
    - Full buffering
    - Generic buffering (с примером количества ключевых полей)
    - Single-record buffering
    - Full with generic key
  - **Как получить**: SE11 документация, SAP Help

- [ ] [TODO.9] Добавить параметры синхронизации буферов
  - **Контекст**: Строки 567-589
  - **Что нужно**:
    - rdisp/bufrefmode
    - Режимы: sendon, sendoff, exeauto
    - Влияние на производительность
  - **Как получить**: SAP Note о buffer synchronization

- [ ] [TODO.10] Детализировать PRIV mode для всех типов WP
  - **Контекст**: Строки 299-423
  - **Что нужно**:
    - Различия для BTC, UPD, SPO процессов
    - Параметры abap/heap_area_* для каждого типа
    - Стратегии управления
  - **Как получить**: Документация по типам work process

- [ ] [TODO.11] Добавить информацию о Memory Inspector
  - **Контекст**: Новая секция после мониторинга
  - **Что нужно**:
    - Транзакция S_MEMORY_INSPECTOR
    - Примеры использования
    - Анализ memory leaks
  - **Как получить**: SAP Help, блоги SCN

- [ ] [TODO.12] Описать механизм memory pipes
  - **Контекст**: Новая подсекция в shared memory
  - **Что нужно**:
    - Концепция memory pipes
    - Использование для IPC
    - Примеры кода
  - **Как получить**: SAP kernel documentation

## Низкий приоритет

- [ ] [TODO.13] Добавить информацию о 32-битных системах
  - **Контекст**: Весь документ
  - **Что нужно**: Ограничения памяти для 32-бит
  - **Как получить**: Legacy documentation

- [ ] [TODO.14] Расширить список буферов
  - **Контекст**: Строки 466-492
  - **Что нужно**:
    - zcsa/presentation_buffer_area
    - Export/Import buffer
    - OTR buffer
  - **Как получить**: ST02 полный список

- [ ] [TODO.15] Добавить best practices для параметров памяти
  - **Контекст**: Строки 759-798
  - **Что нужно**: Таблица рекомендаций по размеру системы
  - **Как получить**: SAP sizing guides

- [ ] [TODO.16] Включить информацию о huge pages
  - **Контекст**: Новая подсекция
  - **Что нужно**: Конфигурация для Linux, преимущества
  - **Как получить**: SAP Note 1824819

- [ ] [TODO.17] Добавить NUMA оптимизации
  - **Контекст**: Новая подсекция
  - **Что нужно**: Влияние на большие системы
  - **Как получить**: SAP HANA guides

- [ ] [TODO.18] Описать memory overcommit стратегии
  - **Контекст**: Новая подсекция
  - **Что нужно**: Рекомендации для виртуализации
  - **Как получить**: SAP on VMware/HyperV guides

## TODO по категориям

### TODO_EXAMPLE (нужны примеры)
- Реальные значения параметров из production систем
- Полные примеры кода для мониторинга
- Скриншоты из ST02, SM04, SMEM
- Примеры проблем с памятью и их решения

### TODO_VERIFY (требует проверки)
- Все значения параметров по умолчанию
- Поведение в современных версиях S/4HANA
- Различия между Suite on HANA и S/4HANA

### TODO_SOURCE (нужны источники)
- SAP Note 1648418 - Memory Management Parameters
- SAP Note 1824819 - Huge Pages configuration
- SAP Note 2085980 - New features in memory management
- SAP Help Portal раздел Memory Management

### TODO_DETAIL (нужны технические детали)
- Точный алгоритм выделения памяти
- Внутренняя структура Extended Memory
- Механизм Copy-on-Write для shared memory
- Детали реализации memory mapping

### TODO_VISUAL (нужны диаграммы)
- Диаграмма полного цикла выделения памяти
- Визуализация фрагментации Extended Memory
- Timeline перехода в PRIV mode
- Сравнение memory layout для разных ОС

### TODO_UPDATE (требует обновления)
- Параметры для S/4HANA 2023
- Изменения в ABAP Platform 2023
- Новые возможности Zero Admin Memory Management
- Cloud-specific ограничения памяти

## Метрики производительности для добавления

1. **Типичное потребление памяти**
   - На пользователя: 4-10 MB (Extended Memory)
   - На сессию: зависит от приложения
   - Background job: может достигать GB

2. **Время выделения памяти**
   - Roll Area: микросекунды
   - Extended Memory: миллисекунды
   - Heap allocation: десятки миллисекунд

3. **Hit ratios для буферов**
   - PXA: должен быть > 98%
   - Table buffer: > 95%
   - Nametab: близко к 100%

4. **Пороговые значения**
   - EM fragmentation: < 10%
   - PRIV процессы: < 20% от общего числа
   - Swap usage: < 20% от RAM

## Примеры кода для добавления

1. Класс для мониторинга памяти с использованием CL_SYSTEM_MONITOR
2. Программа анализа PRIV mode с историей
3. Утилита проверки оптимальности параметров
4. Dashboard памяти с ALV выводом
5. Автоматические алерты при проблемах с памятью

## Дополнительные темы для рассмотрения

1. **Memory в контейнерах** (Docker/Kubernetes)
2. **HANA-специфичные** оптимизации памяти
3. **Влияние кода ABAP** на потребление памяти
4. **Memory profiling** инструменты
5. **Troubleshooting** частых проблем с памятью